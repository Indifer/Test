Some codes are copy from Mono 2.10.